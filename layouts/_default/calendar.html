{{- define "main" }}

<header class="page-header">
  <h1>{{ .Title }}</h1>
</header>

<div id="calendar-container">
  <div id="calendar-nav">
    <button id="prev-month">&lt;</button>
    <span id="current-month"></span>
    <button id="next-month">&gt;</button>
  </div>
  <div id="calendar"></div>
  <div id="posts-for-day"></div>
</div>

<style>
#calendar-container {
  max-width: 800px;
  margin: 0 auto;
}

#calendar-nav {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 20px;
  margin-bottom: 20px;
}

#calendar-nav button {
  background: var(--tertiary);
  border: none;
  padding: 10px 20px;
  font-size: 18px;
  cursor: pointer;
  border-radius: 5px;
}

#calendar-nav button:hover {
  background: var(--secondary);
}

#current-month {
  font-size: 24px;
  font-weight: bold;
  min-width: 200px;
  text-align: center;
}

#calendar {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 5px;
  margin-bottom: 30px;
}

.calendar-header {
  text-align: center;
  font-weight: bold;
  padding: 10px;
  color: var(--secondary);
}

.calendar-day {
  text-align: center;
  padding: 15px 10px;
  border-radius: 5px;
  background: var(--code-bg);
  min-height: 50px;
}

.calendar-day.empty {
  background: transparent;
}

.calendar-day.has-post {
  background: var(--tertiary);
  cursor: pointer;
  position: relative;
}

.calendar-day.has-post:hover {
  background: var(--secondary);
}

.calendar-day.has-post::after {
  content: "";
  position: absolute;
  bottom: 5px;
  left: 50%;
  transform: translateX(-50%);
  width: 8px;
  height: 8px;
  background: #ff5a36;
  border-radius: 50%;
}

.calendar-day.today {
  border: 2px solid var(--primary);
}

#posts-for-day {
  margin-top: 20px;
}

#posts-for-day h3 {
  margin-bottom: 15px;
}

#posts-for-day ul {
  list-style: none;
  padding: 0;
}

#posts-for-day li {
  padding: 10px;
  margin-bottom: 10px;
  background: var(--code-bg);
  border-radius: 5px;
}

#posts-for-day li a {
  text-decoration: none;
  font-weight: 500;
}

#posts-for-day li a:hover {
  text-decoration: underline;
}
</style>

<script>
const posts = [
  {{- range $index, $page := where .Site.RegularPages "Type" "posts" }}
  {{- if $index }},{{ end }}
  {
    "title": {{ .Title | jsonify }},
    "url": "{{ .Permalink }}",
    "date": "{{ .Date.Format "2006-01-02" }}"
  }
  {{- end }}
];

let currentDate = new Date();
const today = new Date();

function renderCalendar() {
  const year = currentDate.getFullYear();
  const month = currentDate.getMonth();
  
  document.getElementById('current-month').textContent = 
    currentDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long' });
  
  const firstDay = new Date(year, month, 1);
  const lastDay = new Date(year, month + 1, 0);
  const startDay = firstDay.getDay();
  const totalDays = lastDay.getDate();
  
  const calendar = document.getElementById('calendar');
  calendar.innerHTML = '';
  
  const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
  days.forEach(day => {
    const header = document.createElement('div');
    header.className = 'calendar-header';
    header.textContent = day;
    calendar.appendChild(header);
  });
  
  for (let i = 0; i < startDay; i++) {
    const empty = document.createElement('div');
    empty.className = 'calendar-day empty';
    calendar.appendChild(empty);
  }
  
  for (let day = 1; day <= totalDays; day++) {
    const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
    const dayPosts = posts.filter(p => p.date === dateStr);
    
    const dayEl = document.createElement('div');
    dayEl.className = 'calendar-day';
    dayEl.textContent = day;
    
    if (dayPosts.length > 0) {
      dayEl.classList.add('has-post');
      dayEl.onclick = () => showPosts(dateStr, dayPosts);
    }
    
    if (year === today.getFullYear() && month === today.getMonth() && day === today.getDate()) {
      dayEl.classList.add('today');
    }
    
    calendar.appendChild(dayEl);
  }
}

function showPosts(date, dayPosts) {
  const container = document.getElementById('posts-for-day');
  const dateObj = new Date(date + 'T00:00:00');
  const formatted = dateObj.toLocaleDateString('en-US', { 
    weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' 
  });
  
  container.innerHTML = `<h3>ðŸ“… ${formatted}</h3><ul>` + 
    dayPosts.map(p => `<li><a href="${p.url}">${p.title}</a></li>`).join('') +
    '</ul>';
}

document.getElementById('prev-month').onclick = () => {
  currentDate.setMonth(currentDate.getMonth() - 1);
  renderCalendar();
};

document.getElementById('next-month').onclick = () => {
  currentDate.setMonth(currentDate.getMonth() + 1);
  renderCalendar();
};

renderCalendar();
</script>

{{- end }}
